!function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){!function(){"use strict";function config($stateProvider,$urlRouterProvider,$httpProvider){$httpProvider.interceptors.push("interceptor"),$urlRouterProvider.otherwise("/"),$stateProvider.state("/",{url:"/",templateUrl:"main.html",controller:"mainController",controllerAs:"vm",resolve:{ping:ping}}).state("/login",{url:"/login",templateUrl:"login.html",controller:"loginController",controllerAs:"vm",resolve:{checkSession:checkSession}}).state("/reservation",{url:"/reservation/:id/:date",templateUrl:"reservation.html",controller:"reservationController",controllerAs:"vm",resolve:{ping:ping}}).state("/tags",{url:"/tags",templateUrl:"tags.html",controller:"tagsController",controllerAs:"vm",resolve:{ping:ping}}).state("/spaces",{url:"/spaces",templateUrl:"spaces.html",controller:"spacesController",controllerAs:"vm",resolve:{ping:ping}})}function ping(ajaxService){return ajaxService.ping()}function checkSession(ajaxService){return ajaxService.checkSession()}function constants(){return{serviceUrl:"/reservations-offices/api/",genericErrorMessage:"An error has occurred",genericSuccessMessage:"Operation successfully achieved",toasterTime:3e3}}angular.module("app").config(config).constant("constants",constants()),ping.$inject=["ajaxService"],checkSession.$inject=["ajaxService"]}()},{}],2:[function(require,module,exports){!function(){"use strict";function appController($scope,$state,storeService,ajaxService,constants){function _activate(){_updateRoute()}function _goToLogin(){$state.go("/login")}function _goToRoot(){$state.go("/")}function _toastError(e,data){var type=e.name,message=data?data:constants.genericErrorMessage;vm.toasterData={type:type,message:message}}function _toastSuccess(e,data){var type=e.name,message=data?data:constants.genericSuccessMessage;vm.toasterData={type:type,message:message}}function _updateRoute(){return $state.current.name&&"/login"!==$state.current.name?void _getCurrentUser().then(function(){vm.route=$state.current.name}):(storeService.resetCurrentUser(),vm.currentUser={},!1)}function _getCurrentUser(){return storeService.getCurrentUser().then(function(currentUser){vm.currentUser=currentUser})}function logout(){storeService.logout().then(function(){$state.go("/login")})}var vm=this;vm.route=null,vm.currentUser={},vm.toasterData={},vm.logout=logout,_activate(),$scope.$watch(function(){return $state.current},_updateRoute),$scope.$on("ERROR",_toastError),$scope.$on("OK",_toastSuccess),$scope.$on("goToLogin",_goToLogin),$scope.$on("goToRoot",_goToRoot)}angular.module("app").controller("appController",appController),appController.$inject=["$scope","$state","storeService","ajaxService","constants"]}()},{}],3:[function(require,module,exports){!function(){"use strict";function confirmationModalController($scope,$uibModalInstance,data){function _activate(){}function cancel(){$uibModalInstance.dismiss("delete")}function accept(){$uibModalInstance.close()}var vm=this;vm.data=data,vm.cancel=cancel,vm.accept=accept,_activate()}angular.module("app").controller("confirmationModalController",confirmationModalController),confirmationModalController.$inject=["$scope","$uibModalInstance","data"]}()},{}],4:[function(require,module,exports){!function(){"use strict";function loginController($scope,$state,storeService,ajaxService){function _activate(){}function login(){vm.status=null,ajaxService.login(vm.username,vm.password).then(function(response){"ERROR"===response.data.status?vm.status=response.data.payload:$state.go("/")})}var vm=this;vm.status=null,vm.username=null,vm.password=null,vm.login=login,_activate()}angular.module("app").controller("loginController",loginController),loginController.$inject=["$scope","$state","storeService","ajaxService"]}()},{}],5:[function(require,module,exports){!function(){"use strict";function mainController($scope,$q,$rootScope,$state,$uibModal,storeService){function _activate(){_getReservationList(),storeService.getCurrentUser().then(function(user){vm.currentUser=user})}function _toastSuccess(){var defer=$q.defer();return $rootScope.$broadcast("OK",""),defer.resolve(),defer.promise}function _getReservationList(){var month=vm.date.getMonth()+1,year=vm.date.getFullYear();vm.loading=!0,storeService.getReservationList(month,year).then(function(reservations){vm.reservations=reservations,vm.loading=!1})}function deleteReservation(reservationId){var date=vm.reservations[reservationId].date,title="About to delete a reservation",body='You are about to delete "'.concat(vm.reservations[reservationId].title).concat(" - ").concat(date.getDate()).concat("/").concat(date.getMonth()).concat("/").concat(date.getFullYear()).concat('". This action cannot be reverted, are you sure?'),modalInstance=$uibModal.open({templateUrl:"confirmation.modal.html",controller:"confirmationModalController",controllerAs:"vm",resolve:{data:{title:title,body:body}}});modalInstance.result.then(function(){storeService.deleteReservation(reservationId).then(_toastSuccess).then(function(){$scope.$broadcast("updateCalendar")})})}function switchVisualization(visualization){vm.visualization=visualization}function next(){vm.date.setMonth(vm.date.getMonth()+1),_getReservationList()}function prev(asd){vm.date.setMonth(vm.date.getMonth()-1),_getReservationList()}function getReservationList(){_getReservationList()}function checkVaidity(date){var time=date.getTime(),yesterday=(new Date).setDate((new Date).getDate()-1);return time>yesterday}var vm=this;vm.visualization="calendar",vm.date=new Date,vm.reservations={},vm.reservationCount=0,vm.currentUser={},vm.deleteReservation=deleteReservation,vm.switchVisualization=switchVisualization,vm.next=next,vm.prev=prev,vm.getReservationList=getReservationList,vm.checkVaidity=checkVaidity,vm.loading=!1,_activate()}angular.module("app").controller("mainController",mainController),mainController.$inject=["$scope","$q","$rootScope","$state","$uibModal","storeService"]}()},{}],6:[function(require,module,exports){!function(){"use strict";function reservationController($scope,$rootScope,$state,$q,$uibModal,storeService,ajaxService,processService){function _activate(){vm.reservation={},vm.newComment="",vm.editableComment=-1,vm.editableCommentText="",vm.filteredTags={},vm.noTagOption={0:{id:0,text:"No tags available"}},vm.selectedTag=null,vm.tempId=null,vm.editEnabled=!0,vm.times=_getTimes(),vm.reservationValidity=!0,vm.currentUser={},vm.tags={},vm.spaces={},vm.lastCheck={},vm.edition={title:null,description:null,body:null,from_time:7,to_time:8,space:1,date:new Date},vm.toggleEdit=toggleEdit,vm.saveReservation=saveReservation,vm.saveComment=saveComment,vm.editComment=editComment,vm.updateComment=updateComment,vm.deleteComment=deleteComment,vm.setTag=setTag,vm.deleteTag=deleteTag,vm.ableToCheckVailidity=!1,vm.loading=!1,$scope.$watch("vm.edition.date",_checkValidity),$scope.$watch("vm.edition.from_time",_checkValidity),$scope.$watch("vm.edition.to_time",_checkValidity),$scope.$watch("vm.edition.space",_checkValidity),isNaN($state.params.id)?(vm.ableToCheckVailidity=!0,$state.params.date&&!isNaN($state.params.date)&&(vm.edition.date=new Date(Number($state.params.date))),$q.all([_getCurrentUser(),_getTags(),_getSpaces()]).then(_filterTags)):_getCurrentUser().then(_getReservation).then(function(){vm.ableToCheckVailidity=!0,_getComments(),_checkValidity(),$q.all([_getReservationTagList(),_getTags(),_getSpaces()]).then(_filterTags)})}function _getTimes(){for(var times=[],i=1;i<=24;i++)times.push(i);return times}function _toastSuccess(){var defer=$q.defer();return $rootScope.$broadcast("OK",""),defer.resolve(),vm.loading=!1,defer.promise}function _getCurrentUser(){return storeService.getCurrentUser().then(function(user){vm.currentUser=user})}function _checkValidity(){var id=vm.reservation.id,day=processService.addZeros(vm.edition.date.getDate()),month=processService.addZeros(vm.edition.date.getMonth()+1),year=vm.edition.date.getFullYear(),from=vm.edition.from_time,to=vm.edition.to_time,space=vm.edition.space,check={id:id,day:day,month:month,year:year,from:from,to:to,space:space},valid=Boolean(!!(day&&month&&year&&from&&to&&space));return vm.ableToCheckVailidity&&valid&&!angular.equals(check,vm.lastCheck)?(vm.lastCheck=check,void ajaxService.reservationValidity(id,day,month,year,from,to,space).then(function(response){vm.reservationValidity=response.data.payload})):(vm.reservationValidity=!1,!1)}function _getReservation(){var defer=$q.defer();return storeService.getReservation(vm.tempId?vm.tempId:$state.params.id).then(function(reservation){vm.reservation=reservation,vm.edition=Object.assign({},reservation),vm.editEnabled=vm.currentUser.id===reservation.creation_user&&reservation.date.getTime()>Date.now(),defer.resolve()}).catch(function(){$state.go("/reservation",{id:"new",date:Date.now()}),storeService.resetReservations(),defer.reject()}),defer.promise}function _getComments(){return storeService.getComments(vm.reservation.id)}function _getReservationTagList(){return storeService.getReservationTagList(vm.reservation.id)}function _getTags(){return storeService.getTags().then(function(tags){vm.tags=tags})}function _getSpaces(){return storeService.getSpaces().then(function(spaces){vm.spaces=spaces})}function _filterTags(){var marker,filteredTags={};if(!vm.reservation.id)return vm.filteredTags=vm.noTagOption,vm.selectedTag=vm.filteredTags[Object.keys(vm.filteredTags)[0]],!1;for(var tagKey in vm.tags){marker=!0;for(var reservationTagKey in vm.reservation.tags)if(reservationTagKey===vm.tags[tagKey].id){marker=!1;break}marker&&(filteredTags[tagKey]=Object.assign({},vm.tags[tagKey]))}vm.filteredTags=filteredTags,Object.keys(vm.filteredTags).length||(vm.filteredTags=vm.noTagOption),vm.selectedTag=vm.filteredTags[Object.keys(vm.filteredTags)[0]]}function _setReservation(){vm.edition.title=vm.edition.title?vm.edition.title:" ",vm.loading=!0;var obj={title:vm.edition.title,description:vm.edition.description,body:vm.edition.body,date:vm.edition.date,from:vm.edition.from_time,to:vm.edition.to_time,space:vm.edition.space,reservation_id:vm.reservation.id};return storeService.setReservation(obj).then(function(id){vm.reservation.id||(vm.tempId=id,$state.go("/reservation",{id:id},{notify:!1,reload:!1,location:"replace",inherit:!0}))}).then(_toastSuccess)}function toggleEdit(){vm.editEnabled=!vm.editEnabled,vm.editEnabled||(vm.edition=Object.assign({},vm.reservation))}function saveReservation(){var date=vm.edition.date,title="About to save a reservation",body='You are about to save "'.concat(vm.edition.title).concat(" - ").concat(date.getDate()).concat("/").concat(date.getMonth()).concat("/").concat(date.getFullYear()).concat('". Are you sure?'),modalInstance=$uibModal.open({templateUrl:"confirmation.modal.html",controller:"confirmationModalController",controllerAs:"vm",resolve:{data:{title:title,body:body}}});modalInstance.result.then(_setReservation).then(_getReservation).then(_getReservationTagList).then(_getComments).then(_filterTags)}function saveComment(){return vm.loading=!0,storeService.setComment(vm.newComment,vm.reservation.id).then(function(){vm.newComment=""}).then(_toastSuccess)}function updateComment(commentId){return vm.loading=!0,storeService.setComment(vm.editableCommentText,null,commentId).then(_toastSuccess).then(editComment)}function editComment(index,commentId){vm.editableCommentText="",vm.editableComment===index?vm.editableComment=-1:(vm.editableComment=index,vm.editableCommentText=commentId?vm.reservation.comments[commentId].text:"")}function deleteComment(commentId){var title=(vm.edition.date,"About to delete a comment"),body="Are you sure?",modalInstance=$uibModal.open({templateUrl:"confirmation.modal.html",controller:"confirmationModalController",controllerAs:"vm",resolve:{data:{title:title,body:body}}});modalInstance.result.then(function(){return vm.loading=!0,storeService.deleteComment(commentId,vm.reservation.id).then(_toastSuccess)})}function setTag(){vm.loading=!0,storeService.setTag(vm.reservation.id,vm.selectedTag.id).then(_getReservationTagList).then(_toastSuccess).then(_filterTags)}function deleteTag(tagId){return vm.loading=!0,storeService.deleteTag(vm.reservation.id,tagId).then(_toastSuccess).then(_filterTags)}var vm=this;_activate()}angular.module("app").controller("reservationController",reservationController),reservationController.$inject=["$scope","$rootScope","$state","$q","$uibModal","storeService","ajaxService","processService"]}()},{}],7:[function(require,module,exports){!function(){"use strict";function spacesController($scope,storeService){function _activate(){storeService.getSpaces().then(function(spaces){vm.spaces=spaces})}var vm=this;vm.spaces={},_activate()}angular.module("app").controller("spacesController",spacesController),spacesController.$inject=["$scope","storeService"]}()},{}],8:[function(require,module,exports){!function(){"use strict";function tagsController($scope,storeService){function _activate(){storeService.getTags().then(function(tags){vm.tags=tags})}var vm=this;vm.tags={},_activate()}angular.module("app").controller("tagsController",tagsController),tagsController.$inject=["$scope","storeService"]}()},{}],9:[function(require,module,exports){!function(){"use strict";function calendarDirective(){function link($scope){function _updateCalendar(){var month=$scope.date.getMonth(),year=$scope.date.getFullYear(),days=_getDaysInMonth(month,year),count=0;days=days.map(function(day){day.items=[],day.empty=!0;for(var item in $scope.data)_compareDates(day.date,$scope.data[item].date)&&(day.items.push($scope.data[item]),day.empty=!1,count++);return day}),$scope.count=count,$scope.days=days}function _getDaysInMonth(month,year){for(var date=new Date(year,month,1),days=[];date.getMonth()===month;)days.push({date:new Date(date)}),date.setDate(date.getDate()+1);return days}function _compareDates(date1,date2){return date1.getTime()===date2.getTime()}function checkVaidity(date){var time=date.getTime(),yesterday=(new Date).setDate((new Date).getDate()-1);return time>yesterday}function getNewHref(date){return checkVaidity(date)?"#/reservation/new/".concat(date.getTime()):""}$scope.days=[],$scope.checkVaidity=checkVaidity,$scope.getNewHref=getNewHref,$scope.$watch("data",_updateCalendar),$scope.$on("updateCalendar",_updateCalendar)}return{restrict:"E",templateUrl:"calendar.directive.html",link:link,scope:{data:"=",date:"=",count:"=",user:"=",delete:"=",newReservation:"="}}}angular.module("app").directive("calendar",calendarDirective),calendarDirective.$inject=[]}()},{}],10:[function(require,module,exports){!function(){"use strict";function toaster(constants){function link($scope,$element,$attr){function _toast(){return!!$scope.data.type&&(clearTimeout(timeout),void(timeout=setTimeout(function(){$scope.data={},$scope.$digest()},constants.toasterTime)))}var timeout=0;$scope.$watch("data",_toast)}return{restrict:"E",templateUrl:"toaster.directive.html",link:link,scope:{data:"="}}}angular.module("app").directive("toaster",toaster),toaster.$inject=["constants"]}()},{}],11:[function(require,module,exports){!function(){"use strict";function dateToNumberFilter(){return function(input){var output=null;return output=input.getTime()}}angular.module("app").filter("dateToNumber",dateToNumberFilter)}()},{}],12:[function(require,module,exports){!function(){"use strict";function departmentFilter(){return function(input){var output;switch(input=String(input)){case"1":output="A";break;case"2":output="B";break;case"3":output="C";break;case"4":output="D";break;case"5":output="E";break;case"6":output="F";break;case"7":output="G";break;default:output="invalid time"}return output}}angular.module("app").filter("department",departmentFilter)}()},{}],13:[function(require,module,exports){!function(){"use strict";function fromTimeFilter(){return function(items,to){items=[].concat(items);for(var i=0;i<items.length;i++)items[i]>=to&&(items.splice(i,1),i--);return items}}angular.module("app").filter("fromTimeFilter",fromTimeFilter)}()},{}],14:[function(require,module,exports){!function(){"use strict";function monthFilter(){return function(items,date){var newItems={};for(var key in items)items[key].date.getMonth()===date.getMonth()&&items[key].date.getFullYear()===date.getFullYear()&&(newItems[key]=items[key]);return newItems}}angular.module("app").filter("monthFilter",monthFilter)}()},{}],15:[function(require,module,exports){!function(){"use strict";function timeFilter(){return function(input){var output;switch(input=String(input)){case"1":output="Morning";break;case"2":output="Evening";break;case"3":output="Afternoon";break;default:output=""}return output}}angular.module("app").filter("time",timeFilter)}()},{}],16:[function(require,module,exports){!function(){"use strict";function toTimeFilter(){return function(items,from){items=[].concat(items);for(var i=0;i<items.length;i++)items[i]<=from&&(items.splice(i,1),i--);return items}}angular.module("app").filter("toTimeFilter",toTimeFilter)}()},{}],17:[function(require,module,exports){require("./modules/app.module"),require("./config"),require("./services/interceptor.service"),require("./services/process.service"),require("./services/ajax.service"),require("./services/store.service"),require("./filters/time.filter"),require("./filters/department.filter"),require("./filters/month.filter"),require("./filters/dateToNumber.filter"),require("./filters/fromTime.filter"),require("./filters/toTime.filter"),require("./directives/toaster.directive"),require("./directives/calendar.directive"),require("./controllers/app.controller"),require("./controllers/login.controller"),require("./controllers/main.controller"),require("./controllers/confirmationModal.controller"),require("./controllers/reservation.controller"),require("./controllers/tags.controller"),require("./controllers/spaces.controller")},{"./config":1,"./controllers/app.controller":2,"./controllers/confirmationModal.controller":3,"./controllers/login.controller":4,"./controllers/main.controller":5,"./controllers/reservation.controller":6,"./controllers/spaces.controller":7,"./controllers/tags.controller":8,"./directives/calendar.directive":9,"./directives/toaster.directive":10,"./filters/dateToNumber.filter":11,"./filters/department.filter":12,"./filters/fromTime.filter":13,"./filters/month.filter":14,"./filters/time.filter":15,"./filters/toTime.filter":16,"./modules/app.module":18,"./services/ajax.service":19,"./services/interceptor.service":20,"./services/process.service":21,"./services/store.service":22}],18:[function(require,module,exports){!function(){"use strict";angular.module("app",["ui.router","ngAnimate","ui.bootstrap"])}()},{}],19:[function(require,module,exports){!function(){"use strict";function ajaxService($http,$httpParamSerializerJQLike,constants){function ping(){return $http.get(url.concat("?route=ping"))}function checkSession(){return $http.get(url.concat("?route=checkSession"))}function login(username,password){return $http({url:url.concat("?route=login"),method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$httpParamSerializerJQLike({username:username,password:password})})}function logout(){return $http.get(url.concat("?route=logout"))}function getCurrentUser(){return $http.get(url.concat("?route=getCurrentUser"))}function reservationValidity(id,day,month,year,from,to,space){return $http.get(url.concat("?route=reservationValidity&day=").concat(day).concat("&month=").concat(month).concat("&year=").concat(year).concat("&from=").concat(from).concat("&to=").concat(to).concat("&space=").concat(space).concat("&id=").concat(id))}function getReservation(reservationId){return $http.get(url.concat("?route=getReservation&id=").concat(reservationId))}function getReservationList(month,year){return $http.get(url.concat("?route=getReservationList&month=").concat(month).concat("&year=").concat(year))}function getReservationTagList(reservationId){return $http.get(url.concat("?route=getReservationTagList&reservation_id=").concat(reservationId))}function getComments(reservationId){return $http.get(url.concat("?route=getComments&reservation_id=").concat(reservationId))}function getTags(){return $http.get(url.concat("?route=getTags"))}function getSpaces(){return $http.get(url.concat("?route=getSpaces"))}function saveReservation(obj){return $http({url:url.concat("?route=saveReservation"),method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$httpParamSerializerJQLike(obj)})}function updateReservation(obj){return $http({url:url.concat("?route=updateReservation"),method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$httpParamSerializerJQLike(obj)})}function deleteReservation(reservationId){return $http({url:url.concat("?route=deleteReservation"),method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$httpParamSerializerJQLike({reservation_id:reservationId})})}function addTag(reservationId,tagId){return $http({url:url.concat("?route=addTag"),method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$httpParamSerializerJQLike({reservation_id:reservationId,tag_id:tagId})})}function removeTag(reservationId,tagId){return $http({url:url.concat("?route=removeTag"),method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$httpParamSerializerJQLike({reservation_id:reservationId,tag_id:tagId})})}function saveComment(comment,reservationId){return $http({url:url.concat("?route=saveComment"),method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$httpParamSerializerJQLike({comment:comment,reservation_id:reservationId})})}function deleteComment(commentId){return $http({url:url.concat("?route=deleteComment"),method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$httpParamSerializerJQLike({comment_id:commentId})})}function updateComment(comment,commentId){return $http({url:url.concat("?route=updateComment"),method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$httpParamSerializerJQLike({comment_id:commentId,comment:comment})})}function saveTag(tag){return $http({url:url.concat("?route=saveTag"),method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$httpParamSerializerJQLike({tag:tag})})}var url=constants.serviceUrl;return{ping:ping,checkSession:checkSession,getReservation:getReservation,getReservationList:getReservationList,getReservationTagList:getReservationTagList,getComments:getComments,getTags:getTags,logout:logout,reservationValidity:reservationValidity,getCurrentUser:getCurrentUser,getSpaces:getSpaces,saveReservation:saveReservation,updateReservation:updateReservation,deleteReservation:deleteReservation,addTag:addTag,removeTag:removeTag,saveComment:saveComment,deleteComment:deleteComment,updateComment:updateComment,saveTag:saveTag,login:login}}angular.module("app").factory("ajaxService",ajaxService),ajaxService.$inject=["$http","$httpParamSerializerJQLike","constants"]}()},{}],20:[function(require,module,exports){!function(){"use strict";function interceptor($q,$rootScope){function request(config){return config}function requestError(rejection){return $q.reject(rejection)}function response(response){return"ERROR"===response.data.status?($rootScope.$broadcast("ERROR",response.data.payload),$q.reject(response)):response}function responseError(rejection){403===rejection.status&&$rootScope.$broadcast("goToLogin"),400===rejection.status&&$rootScope.$broadcast("goToRoot");rejection.data.payload?rejection.data.payload:"";return $q.reject(rejection)}return{request:request,requestError:requestError,response:response,responseError:responseError}}angular.module("app").factory("interceptor",interceptor),interceptor.$inject=["$q","$rootScope"]}()},{}],21:[function(require,module,exports){!function(){"use strict";function processService(){function addZeros(number){return number<10?"0".concat(number):number}function dbArrayAdapter(dbArray){var value,dbObject={},tempObj={};return"object"!=typeof dbArray?tempObj:(dbArray.forEach(function(object){tempObj={};for(var key in object)value=object[key],new RegExp("timestamp","i").test(key)&&(value=new Date(value)),"DATE"===key&&(value=new Date(value.replace("-","/").replace("-","/"))),!isNaN(value)&&"string"==typeof value&&value.trim()&&(value=Number(value)),tempObj[key.toLowerCase()]=value;dbObject[tempObj.id]=tempObj}),dbObject)}return{dbArrayAdapter:dbArrayAdapter,addZeros:addZeros}}angular.module("app").factory("processService",processService),processService.$inject=[]}()},{}],22:[function(require,module,exports){!function(){"use strict";function storeService(ajaxService,processService,$q){function logout(){var defer=$q.defer();return ajaxService.logout().then(function(){resetCurrentUser(),resetReservations(),resetTags(),resetComments(),defer.resolve()}),defer.promise}function getCurrentUser(){var adapted=null,firstRequest=!1;return currentUserDefer||(firstRequest=!0,currentUserDefer=$q.defer()),currentUser.id&&currentUserDefer.resolve(currentUser),!currentUser.id&&firstRequest&&ajaxService.getCurrentUser().then(function(response){adapted=processService.dbArrayAdapter([response.data.payload]),currentUser=adapted[Object.keys(adapted)[0]],currentUserDefer.resolve(currentUser)}),currentUserDefer.promise}function getReservation(reservationId){var reservation,defer=$q.defer();return reservations[reservationId]?defer.resolve(reservations[reservationId]):ajaxService.getReservation(reservationId).then(function(response){return response.data.payload.length?(reservation=processService.dbArrayAdapter(response.data.payload),reservations[reservationId]=reservation[Object.keys(reservation)[0]],void defer.resolve(reservations[reservationId])):(defer.reject(),defer.promise)}),defer.promise}function getReservationList(month,year){var defer=$q.defer();return ajaxService.getReservationList(month,year).then(function(response){reservations=Object.assign(processService.dbArrayAdapter(response.data.payload),reservations),defer.resolve(reservations)}),defer.promise}function getReservationTagList(reservationId){var reservationTags,defer=$q.defer();return ajaxService.getReservationTagList(reservationId).then(function(response){reservationTags=processService.dbArrayAdapter(response.data.payload),Object.assign(tags,reservationTags),reservations[reservationId].tags=reservationTags,defer.resolve(reservationTags)}),defer.promise}function getComments(reservationId){var newComments,defer=$q.defer();return ajaxService.getComments(reservationId).then(function(response){newComments=processService.dbArrayAdapter(response.data.payload),Object.assign(comments,newComments),reservations[reservationId].comments=newComments,defer.resolve()}),defer.promise}function getTags(){var defer=$q.defer();return Object.keys(tags).length?defer.resolve(tags):ajaxService.getTags().then(function(response){tags=Object.assign(processService.dbArrayAdapter(response.data.payload),tags),defer.resolve(tags)}),defer.promise}function getSpaces(){var defer=$q.defer();return Object.keys(spaces).length?defer.resolve(spaces):ajaxService.getSpaces().then(function(response){spaces=Object.assign(processService.dbArrayAdapter(response.data.payload),spaces),defer.resolve(spaces)}),defer.promise}function setReservation(obj){var defer=$q.defer();return obj.reservation_id?ajaxService.updateReservation(obj).then(function(response){resetReservation(obj.reservation_id),defer.resolve(obj.reservation_id)}):ajaxService.saveReservation(obj).then(function(response){defer.resolve(response.data.payload)}),defer.promise}function setTag(reservationId,tagId,tag){var defer=$q.defer();return ajaxService.addTag(reservationId,tagId).then(function(response){defer.resolve(response.data.payload)}),defer.promise}function setComment(comment,reservationId,commentId){var defer=$q.defer(),newComment={};return commentId?ajaxService.updateComment(comment,commentId).then(function(response){comments[commentId].text=comment,defer.resolve(response)}):ajaxService.saveComment(comment,reservationId).then(function(response){newComment={id:response.data.payload,text:comment,creation_timestamp:new Date,creation_user:currentUser.id,floor:currentUser.floor,department:currentUser.department},comments[response.data.payload]=newComment,reservations[reservationId].comments[response.data.payload]=newComment,defer.resolve(response)}),defer.promise}function deleteTag(reservationId,tagId){var defer=$q.defer();return ajaxService.removeTag(reservationId,tagId).then(function(response){delete reservations[reservationId].tags[tagId],defer.resolve()}),defer.promise}function deleteReservation(reservationId){var defer=$q.defer();return ajaxService.deleteReservation(reservationId).then(function(response){if(reservations[reservationId].comments)for(var key in reservations[reservationId].comments)delete comments[key];delete reservations[reservationId],defer.resolve(response)}),defer.promise}function deleteComment(commentId,reservationId){var defer=$q.defer();return ajaxService.deleteComment(commentId).then(function(response){delete comments[commentId],delete reservations[reservationId].comments[commentId],defer.resolve(response)}),defer.promise}function resetReservations(){reservations={}}function resetReservation(reservationId){delete reservations[reservationId]}function resetTags(){tags={}}function resetComments(){comments={}}function resetCurrentUser(){currentUserDefer=null,currentUser={}}var reservations={},comments={},tags={},spaces={},currentUser={},currentUserDefer=null;return{getReservation:getReservation,getReservationList:getReservationList,getReservationTagList:getReservationTagList,getComments:getComments,getTags:getTags,getCurrentUser:getCurrentUser,getSpaces:getSpaces,setReservation:setReservation,setTag:setTag,setComment:setComment,deleteTag:deleteTag,deleteReservation:deleteReservation,deleteComment:deleteComment,resetReservations:resetReservations,resetComments:resetComments,resetTags:resetTags,resetCurrentUser:resetCurrentUser,logout:logout}}angular.module("app").factory("storeService",storeService),storeService.$inject=["ajaxService","processService","$q"]}()},{}]},{},[17]);